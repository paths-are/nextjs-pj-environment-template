Next.js の開発環境を Docker で構築したときの手順を記載します。
docker-compose を使っています。

# 新規環境構築手順

## フォルダとファイルを作成する

```bash
mkdir project && cd project && touch docker-compose.yml
```

## docker-compose.yml の内容

```yml:docker-compose.yml
version: '3'
services:
  app:
    image: node:14.17.0
    working_dir: /usr/src/app
    volumes:
      - ./:/usr/src/app
    command: sh -c "cd front-root && npm run dev"
    ports:
      - "3000:3000"
```

## TypeScript を使った環境を構築

```bash
docker-compose run --rm app npm install create-next-app
```

```bash
docker-compose run --rm app npx create-next-app front-root --ts
```

## Docker 起動

```bash
docker-compose run --rm app yarn # ライブラリのインストール
```

```bash
docker-compose up -d # 起動
```

## Docker 停止

```bash
docker-compose stop # 停止
```

## コンテナに入る

docker exec -it project_app_1 /bin/bash

## ファイルの権限を変更する

```bash
sudo chmod -R 777 front-root/ # ファイルを編集可にする
```

## 参考

https://zenn.dev/tasuya/articles/da033574b85e6d

以上で Next.js+TypeScript の環境構築は終わりです。
次に MUI の導入を行います。

# MUI 導入

https://mui.com/

(docker は停止していて方がよい)

front-root で以下のコマンドを実行します。
yarn add @mui/material @mui/icons-material @emotion/styled @emotion/server @emotion/react @emotion/cache

下記の Github を参考に足りないところを埋めていきます。
https://github.com/mui/material-ui/tree/master/examples/nextjs-with-typescript
自分は下記のファイルを編集した
pages/\_app.tsx, pages/\_document.tsx
src/theme.ts, src/createEmotionCache.ts

# Firebase 導入

https://firebase.google.com/

下記の機能を導入していく

- Firebase Authentication
- Firebase Firestore Database
- Firebase Storage
- Firebase Functions
- Firebase Analytics
- Firebase Cloud Messaging
- Firebase Extensions
  - Run Payments with Stripe

Firebase のプロジェクトを作成する

- プロジェクト名の入力
- アナリティクス設定 → とりあえず ON にする
- アナリティクスアカウントの設定

プロジェクトの設定 > マイアプリ > Web アプリの追加
ニックネーム：NextjsProjectTemplate

```typescript:src/firebase/init.ts
import { initializeApp } from "firebase/app";

const firebaseConfig = {
  apiKey: "AIzaSyDH6r-5P47nSAMF2e5MX9mG_jlP_GJijS0",
  authDomain: "nextjsprojecttemplate.firebaseapp.com",
  projectId: "nextjsprojecttemplate",
  storageBucket: "nextjsprojecttemplate.appspot.com",
  messagingSenderId: "797170251988",
  appId: "1:797170251988:web:8ce84d6ce93f62efbd2341",
  measurementId: "G-CMCNRE5YYG",
};

// Initialize Firebase
export const app = initializeApp(firebaseConfig);
```

## Firebase Analytics 導入
_app.tsxでgetAnalytics()を読み込むだけ。
この設定だけでPageView測定はできる。
カスタマイズでイベントログを取りたい場合は[こちら](https://firebase.google.com/docs/analytics/events?hl=ja&platform=web)を参考に。

```typescript:pages/_app.tsx
import { getAnalytics } from "firebase/analytics";
import { app } from "@/src/firebase/init";

if (typeof window !== "undefined") {
  getAnalytics(app);
}
```

下記の Chrome 拡張機能をインストールする  
[Google Analytics Debugger](https://chrome.google.com/webstore/detail/google-analytics-debugger/jnkmfdileelhofjcijamephohjechhna?hl=ja)
もし「Google Analytics オプトアウト アドオン (by Google)」という拡張機能をインストールしているならこの拡張機能は OFF にしておく必要がある。

## Firebase Authentication
Firebaseの管理画面でAuthenticationを有効化する
Google認証とメールアドレス認証を有効化する
あとは好きにカスタマイズする
